---
title: "Supplementary Information for manuscript: **Conflict-Reducing Innovations in Development Enable Increased Multicellular Complexity**"
author:
  - Jack Howe, Copenhagen University, Denmark
  - Charlie K. Cornwallis, Lund University, Sweden
  - Ashleigh S. Griffin, University of Oxford, U.K.
output:
  pdf_document: 
    toc: true
    toc_depth: 3
  word_document: default
  html_document:
    toc: true
    toc_float: true
    toc_collapsed: true
    toc_depth: 3
    df_print: paged
---


```{r setup, include = FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
  )
knitr::opts_knit$set(root.dir = '/Users/pcx971/Documents/oxford/complexity/complexity_project')

```

```{r LoadPackages, include = F}

library(ape)
library(tidyverse)
library(MCMCglmm)
library(parallel)
library(coda)
library(ggthemes)
library(ggpubr)
library(ggmcmc)
library(bayesplot)

source('/Users/pcx971/Documents/oxford/complexity/complexity_project/RScripts/pMCMC_Script.R')

```

\listoftables
\newpage

# Manuscript Information

*Conflict-Reducing Innovations in Development Enable Increased Multicellular Complexity*

Journal: Proceedings of the Royal Society B

DOI: https://doi.org/10.1098/rspb.2023.2466


\newpage

# Parameters used

Priors sets 1, 2, and 3 were used for testing the effects of strict bottlenecks and germline timing on number of cells and number of cell types
Prior set 4 was used for testing for a phylogenetic correlation between early germline segregation and the presence of a strict bottleneck

### Prior set 1
p1=list(R = list(V = 1, nu=0.002), 
            G = list(G1=list(V = 1, nu = 0.002)))

### Prior set 2
p2=list(R=list(V=1, nu=1), 
             G=list(G1=list(V=1, nu=1, alpha.mu=0, alpha.var=1000)))

### Prior set 3
p3=list(R=list(V=1, nu=2),
        G=list(G1=list(V=1, nu=2, alpha.mu=0, alpha.var=1000)))

### Prior set 4
p4=list(B=list(mu=c(0,0), V=diag(c(1+pi^2/3,1+pi^2/3))),
            R = list(V = diag(2),nu=1, fix=1),
            G = list(G1=list(V = diag(2), nu = 1, alpha.mu = c(0,0), alpha.V = diag(c(1000,1000)))))
            
### Prior set 5
p5 = list(B=list(mu=c(0), V=1+pi^2/3),R = list(V = 1, nu=1,fix=1), G = list(G1=list(V=1, nu=1, alpha.mu=0, alpha.V=1000)))

### MCMCglmm parameters
+ iterations: 8*10^6
+ burnin: 10^6
+ thinning: 1000
+ number of chains: 6

These parameters were decided based on running Model 1 over a range of parameters to determine the combination that limited variance. 

```{r OptimisationFigure, echo = F}
knitr::include_graphics("Results/SpeciesLevel/All/Figures/Optimisation.pdf")
```

# Description of Models

## Model 1
*Number of Cells ~ Presence of Strict Bottleneck*.   
Priors used: p1, p2, p3

Family = Poisson.  

Code in `RScripts/4_Model1_ROTL.R`


## Model 2
*Number of Cell Types ~  Presence of Strict Bottleneck + log(Number of Cells)*
Priors used: p1, p2, p3

Family = Poisson  

Code in `RScripts/5_Model2_ROTL.R`

The logged values of the number of cells were scaled


## Model 3
*Number of Cells ~ Timing of Germline Segregation*
Priors used: p1, p2, p3

Family = Poisson  

Code in `RScripts/6_Model3_ROTL.R`


## Model 4
*Number of Cell Types ~ Timing of Germline Segregation + log(Number of Cells)*
Priors used: p1, p2, p3

Family = Poisson  

Code in `RScripts/7_Model4_ROTL.R`

The logged values of the number of cells were scaled

## Model 5
*Number of Cell Types ~ Timing of Germline Segregation *

Family = Poisson

Code in `RScripts/9_GermlineWithoutCellNumber.R`

## Correlation Analyses
*(Presence of Strict Bottleneck , Early vs Late Germline Timing) ~ trait-1*

Code in `RScripts/8_Multiresponse_ROTL.R`

## Ancestral State Reconstructions
For ancestral state reconstruction, we constructed four models: 1 with each of our explanatory variables as the response variable, and only the phylogeny (as an inverse matrix).
This gives the intercept of the trait of interest. 

The models run were therefore:

*Number of Cell Types ~ 1*

*Number of Cells ~ 1*

*Presence of strict bottleneck ~ 1*

*Timing of Germline Segregation ~ 1*

Code in `RScripts/10_AncestralStateReconstructions.R`



\newpage
# Analyses including data from congeners

```{r, echo=F}
GenusVsSpecies = 'Genus'
```

## Analyses with all data points
```{r, echo=F}
WhichTaxa='All'
```


### Model 1: *Number of Cells ~ Presence of Strict Bottleneck*


```{r GenusAllModel1, results='asis', echo=FALSE}
Model=1
p=1
  for(prior_set in c('p1','p2','p3')){
    
    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')
    
    ModelOutput <- readRDS(input_filename)
  
    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)  
    Sol_ggSubset<- subset(Sol_gg,  grepl('Fission', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species
    
    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()
    
    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)
    
    NoFission<- Sol_gg %>%
      filter(Parameter == 'Fission0') %>% 
      rename(Fission0 = value) %>% select(-Parameter)
    
    Fission<- Sol_gg %>%
      filter(Parameter == 'Fission1') %>%
      rename(Fission1 = value) %>% select(-Parameter)
    
    Difference<- merge(Fission, NoFission) %>%
      mutate(Difference = Fission1 - Fission0)
  
    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)
    
    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) + geom_density() + theme_minimal() + geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) + geom_segment(x = HDI_95$CI_low, y = 0, xend =  HDI_95$CI_high, yend = 0, colour = 'grey', size = 1) 
    
    SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")
    SummaryPlot
    
    #pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1, 
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")
  
   header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")  
    cat(header)
    caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)
    
    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)
    
    
  cat("\n")
  #cat("\\newpage")
  cat("\n")    
  
  print(SummaryPlot)
  #dev.off() 
  p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")  
  }
```

### Model 2: *Number of Cell Types ~  Presence of Strict Bottleneck + log(Number of Cells)*


```{r GenusAllModel2, results='asis', echo=FALSE}
Model=2
p=1
  for(prior_set in c('p1','p2','p3')){
    
    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')
    
    ModelOutput <- readRDS(input_filename)
  
    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)  
    Sol_ggSubset<- subset(Sol_gg,  grepl('Fission', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species
    
    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()
    
    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)
    
    NoFission<- Sol_gg %>%
      filter(Parameter == 'Fission0') %>% 
      rename(Fission0 = value) %>% select(-Parameter)
    
    Fission<- Sol_gg %>%
      filter(Parameter == 'Fission1') %>%
      rename(Fission1 = value) %>% select(-Parameter)
    
    Difference<- merge(Fission, NoFission) %>%
      mutate(Difference = Fission1 - Fission0)
  
    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)
    
    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) + geom_density() + theme_minimal() + geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) + geom_segment(x = HDI_95$CI_low, y = 0, xend =  HDI_95$CI_high, yend = 0, colour = 'grey', size = 1) 
    
    SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")
    SummaryPlot
    
    #pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1, 
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")
  
   header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")  
    cat(header)
     
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)
    
    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)
    
    
  cat("\n")
  #cat("\\newpage")
  cat("\n")    
  
  print(SummaryPlot)
  #dev.off() 
  p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")  
  }
```

### Model 3: *Number of Cells ~ Timing of Germline Segregation*


```{r GenusAllModel3, results='asis', echo=FALSE}
Model = 3
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')    
    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```

### Model 4: *Number of Cell Types ~ Timing of Germline Segregation + log(Number of Cells)*


```{r GenusAllModel4, results='asis', echo=FALSE}
Model = 4
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```


### Model 5: *Number of Cell Types ~ Timing of Germline Segregation *


```{r GenusAllModel5, results='asis', echo=FALSE}
Model = '4WithoutCellNumber'
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')   
    
    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
    
    caption1 = paste("Estimates of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)



  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```

### Correlation between germline and fission 

This analysis was run to test for a phylogenetic association between early germline segregation and a strict bottleneck separating each generation. Prior set 4 above was used.

```{r GenusAllCorrelation, echo=F, results='asis'}
prior_set = 'p4'
Model = '_Correlation'

Model_Correlation_File<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')

Model_Correlation<- readRDS(Model_Correlation_File)

Model_Correlation_ROTL_Sol<- mcmc.list(lapply(Model_Correlation, function(m) m$Sol))
#plot(Model_Correlation_ROTL_Sol) 
#gelman.diag(Model_Correlation_ROTL_Sol,multivariate = FALSE)

Model_Correlation_ROTL_VCV<- mcmc.list(lapply(Model_Correlation, function(m) m$VCV))
#plot(Model_Correlation_ROTL_VCV) 
#gelman.diag(Model_Correlation_ROTL_VCV,multivariate = FALSE)
chain1<- Model_Correlation$chain1
#summary(Model_Correlation$chain1)


#phylogenetic heritability in each trait [intraclass correlation coefficient (ICC) for binary traits]
ICC_fission1<-chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
# posterior.mode(ICC_fission1)
# HPDinterval(ICC_fission1)
#plot(ICC_fission1)

ICC_germline1<-chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
#posterior.mode(ICC_germline1)
#HPDinterval(ICC_germline1)
#plot(ICC_germline1)


#calculate phylogenetic correlation
fission_germline1<-chain1$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])
#plot(fission_germline1)
#print(posterior.mode(fission_germline1))
#print(HPDinterval(fission_germline1))

#Can check the convergence of these terms
chain2<- Model_Correlation$chain2
chain3<- Model_Correlation$chain3
chain4<- Model_Correlation$chain4
chain5<- Model_Correlation$chain5
chain6<- Model_Correlation$chain6

ICC_fission2<-chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline2<-chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline2<-chain2$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission3<-chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline3<-chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline3<-chain3$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission4<-chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline4<-chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline4<-chain4$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission5<-chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline5<-chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline5<-chain5$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission6<-chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline6<-chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline6<-chain6$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission<-mcmc.list(ICC_fission1,ICC_fission2,ICC_fission3,ICC_fission4,ICC_fission5,ICC_fission6)
ICC_germline<-mcmc.list(ICC_germline1,ICC_germline2,ICC_germline3,ICC_germline4,ICC_germline5,ICC_germline6)
fission_germline<-mcmc.list(fission_germline1,fission_germline2,fission_germline3,fission_germline4,fission_germline5,fission_germline6)
varnames(fission_germline) <- 'correlation'


# plot(ICC_fission)
# gelman.diag(ICC_fission,multivariate = FALSE)
# 
# plot(ICC_germline)
# gelman.diag(ICC_germline,multivariate = FALSE)z
# 
# plot(fission_germline)
# gelman.diag(fission_germline,multivariate = FALSE)

```


Figure: A shows the convergence of all chains, B and C both show the posterior estimates and confidence intervals for the correlation between the *absence* of a strict bottleneck, and the *presence* of early germline segregation. 
This is shown only for 1 chain.

```{r GenusAllCorrelation2, echo=F, results='asis'}
#cat(summary(fission_germline))

trace<- mcmc_trace(fission_germline) + theme_minimal()
areas<- mcmc_areas(fission_germline) + theme_minimal()
intervals<- mcmc_intervals(fission_germline) + theme_minimal()

a<- ggarrange(trace, areas, intervals, ncol = 3, labels = 'AUTO')
a
```

For each chain, the posterior CI were as follows  
```{r}
HPDinterval(fission_germline)
```


### Ancestral state reconstruction
```{r GenusAllAncestralState, echo = F, out.width="100%"}
knitr::include_graphics(paste("Results/", GenusVsSpecies,"Level/", WhichTaxa, "/Figures/AllPlotsPhylogeny.pdf", sep = ''))
```



```{r, echo=F}
GenusVsSpecies = 'Genus'
```

## Analyses with data points from only the animals
```{r, echo=F}
WhichTaxa='OnlyAnimals'
```


### Model 1: *Number of Cells ~ Presence of Strict Bottleneck*



```{r GenusAnimalsModel1, results='asis', echo=FALSE}
Model=1
p=1
  for(prior_set in c('p1','p2','p3')){
    
    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')
    
    ModelOutput <- readRDS(input_filename)
  
    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)  
    Sol_ggSubset<- subset(Sol_gg,  grepl('Fission', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species
    
    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()
    
    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)
    
    NoFission<- Sol_gg %>%
      filter(Parameter == 'Fission0') %>% 
      rename(Fission0 = value) %>% select(-Parameter)
    
    Fission<- Sol_gg %>%
      filter(Parameter == 'Fission1') %>%
      rename(Fission1 = value) %>% select(-Parameter)
    
    Difference<- merge(Fission, NoFission) %>%
      mutate(Difference = Fission1 - Fission0)
  
    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)
    
    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) + geom_density() + theme_minimal() + geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) + geom_segment(x = HDI_95$CI_low, y = 0, xend =  HDI_95$CI_high, yend = 0, colour = 'grey', size = 1) 
    
    SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")
    SummaryPlot
    
    #pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1, 
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")
  
   header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")  
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)
    
    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)
    
    
  cat("\n")
  #cat("\\newpage")
  cat("\n")    
  
  print(SummaryPlot)
  #dev.off() 
  p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")  
  }
```

### Model 2: *Number of Cell Types ~  Presence of Strict Bottleneck + log(Number of Cells)*


```{r GenusAnimalsModel2, results='asis', echo=FALSE}
Model=2
p=1
  for(prior_set in c('p1','p2','p3')){
    
    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')
    
    ModelOutput <- readRDS(input_filename)
  
    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)  
    Sol_ggSubset<- subset(Sol_gg,  grepl('Fission', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species
    
    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()
    
    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)
    
    NoFission<- Sol_gg %>%
      filter(Parameter == 'Fission0') %>% 
      rename(Fission0 = value) %>% select(-Parameter)
    
    Fission<- Sol_gg %>%
      filter(Parameter == 'Fission1') %>%
      rename(Fission1 = value) %>% select(-Parameter)
    
    Difference<- merge(Fission, NoFission) %>%
      mutate(Difference = Fission1 - Fission0)
  
    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)
    
    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) + geom_density() + theme_minimal() + geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) + geom_segment(x = HDI_95$CI_low, y = 0, xend =  HDI_95$CI_high, yend = 0, colour = 'grey', size = 1) 
    
    SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")
    SummaryPlot
    
    #pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1, 
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")
  
   header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")  
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)
    
    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)
    
    
  cat("\n")
  #cat("\\newpage")
  cat("\n")    
  
  print(SummaryPlot)
  #dev.off() 
  p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")  
  }
```

### Model 3: *Number of Cells ~ Timing of Germline Segregation*


```{r GenusAnimalsModel3, results='asis', echo=FALSE}
Model = 3
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')    
    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```

### Model 4: *Number of Cell Types ~ Timing of Germline Segregation + log(Number of Cells)*


```{r GenusAnimalsModel4, results='asis', echo=FALSE}
Model = 4
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```


### Model 5: *Number of Cell Types ~ Timing of Germline Segregation *


```{r GenusAnimalsModel5, results='asis', echo=FALSE}
Model = '4WithoutCellNumber'
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')   
    
    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
    caption1 = paste("Estimates of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)



  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```

### Correlation between germline and fission 

This analysis was run to test for a phylogenetic association between early germline segregation and a strict bottleneck separating each generation. Prior set 4 above was used.

```{r GenusAnimalCorrelation, echo=F, results='asis'}
prior_set = 'p4'
Model = '_Correlation'

Model_Correlation_File<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')

Model_Correlation<- readRDS(Model_Correlation_File)

Model_Correlation_ROTL_Sol<- mcmc.list(lapply(Model_Correlation, function(m) m$Sol))
#plot(Model_Correlation_ROTL_Sol) 
#gelman.diag(Model_Correlation_ROTL_Sol,multivariate = FALSE)

Model_Correlation_ROTL_VCV<- mcmc.list(lapply(Model_Correlation, function(m) m$VCV))
#plot(Model_Correlation_ROTL_VCV) 
#gelman.diag(Model_Correlation_ROTL_VCV,multivariate = FALSE)
chain1<- Model_Correlation$chain1
#summary(Model_Correlation$chain1)


#phylogenetic heritability in each trait [intraclass correlation coefficient (ICC) for binary traits]
ICC_fission1<-chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
# posterior.mode(ICC_fission1)
# HPDinterval(ICC_fission1)
#plot(ICC_fission1)

ICC_germline1<-chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
#posterior.mode(ICC_germline1)
#HPDinterval(ICC_germline1)
#plot(ICC_germline1)


#calculate phylogenetic correlation
fission_germline1<-chain1$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])
#plot(fission_germline1)
#print(posterior.mode(fission_germline1))
#print(HPDinterval(fission_germline1))

#Can check the convergence of these terms
chain2<- Model_Correlation$chain2
chain3<- Model_Correlation$chain3
chain4<- Model_Correlation$chain4
chain5<- Model_Correlation$chain5
chain6<- Model_Correlation$chain6

ICC_fission2<-chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline2<-chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline2<-chain2$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission3<-chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline3<-chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline3<-chain3$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission4<-chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline4<-chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline4<-chain4$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission5<-chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline5<-chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline5<-chain5$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission6<-chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline6<-chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline6<-chain6$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission<-mcmc.list(ICC_fission1,ICC_fission2,ICC_fission3,ICC_fission4,ICC_fission5,ICC_fission6)
ICC_germline<-mcmc.list(ICC_germline1,ICC_germline2,ICC_germline3,ICC_germline4,ICC_germline5,ICC_germline6)
fission_germline<-mcmc.list(fission_germline1,fission_germline2,fission_germline3,fission_germline4,fission_germline5,fission_germline6)
varnames(fission_germline) <- 'correlation'


# plot(ICC_fission)
# gelman.diag(ICC_fission,multivariate = FALSE)
# 
# plot(ICC_germline)
# gelman.diag(ICC_germline,multivariate = FALSE)z
# 
# plot(fission_germline)
# gelman.diag(fission_germline,multivariate = FALSE)

```


Figure: A shows the convergence of all chains, B and C both show the posterior estimates and confidence intervals for the correlation between the *absence* of a strict bottleneck, and the *presence* of early germline segregation. 
This is shown only for 1 chain.

```{r GenusAnimalsCorrelation2, echo=F, results='asis'}
#cat(summary(fission_germline))

trace<- mcmc_trace(fission_germline) + theme_minimal()
areas<- mcmc_areas(fission_germline) + theme_minimal()
intervals<- mcmc_intervals(fission_germline) + theme_minimal()

a<- ggarrange(trace, areas, intervals, ncol = 3, labels = 'AUTO')
a
```

For each chain, the posterior CI were as follows  
```{r}
HPDinterval(fission_germline)
```


### Ancestral state reconstruction
```{r GenusAnimalsAncestralState, echo = F, out.width="100%"}
knitr::include_graphics(paste("Results/", GenusVsSpecies,"Level/", WhichTaxa, "/Figures/AllPlotsPhylogeny.pdf", sep = ''))
```



## Analyses with data points excluding the animals
```{r, echo=F}
WhichTaxa='NoAnimals'
```


### Model 1: *Number of Cells ~ Presence of Strict Bottleneck*

```{r GenusNoAnimalsModel1, results='asis', echo=FALSE}
Model=1
p=1
  for(prior_set in c('p1','p2','p3')){
    
    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')
    
    ModelOutput <- readRDS(input_filename)
  
    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)  
    Sol_ggSubset<- subset(Sol_gg,  grepl('Fission', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species
    
    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()
    
    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)
    
    NoFission<- Sol_gg %>%
      filter(Parameter == 'Fission0') %>% 
      rename(Fission0 = value) %>% select(-Parameter)
    
    Fission<- Sol_gg %>%
      filter(Parameter == 'Fission1') %>%
      rename(Fission1 = value) %>% select(-Parameter)
    
    Difference<- merge(Fission, NoFission) %>%
      mutate(Difference = Fission1 - Fission0)
  
    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)
    
    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) + geom_density() + theme_minimal() + geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) + geom_segment(x = HDI_95$CI_low, y = 0, xend =  HDI_95$CI_high, yend = 0, colour = 'grey', size = 1) 
    
    SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")
    SummaryPlot
    
    #pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1, 
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")
  
   header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")  
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)
    
    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)
    
    
  cat("\n")
  #cat("\\newpage")
  cat("\n")    
  
  print(SummaryPlot)
  #dev.off() 
  p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")  
  }
```

### Model 2: *Number of Cell Types ~  Presence of Strict Bottleneck + log(Number of Cells)*


```{r GenusNoAnimalsModel2, results='asis', echo=FALSE}
Model=2
p=1
  for(prior_set in c('p1','p2','p3')){
    
    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')
    
    ModelOutput <- readRDS(input_filename)
  
    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)  
    Sol_ggSubset<- subset(Sol_gg,  grepl('Fission', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species
    
    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()
    
    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)
    
    NoFission<- Sol_gg %>%
      filter(Parameter == 'Fission0') %>% 
      rename(Fission0 = value) %>% select(-Parameter)
    
    Fission<- Sol_gg %>%
      filter(Parameter == 'Fission1') %>%
      rename(Fission1 = value) %>% select(-Parameter)
    
    Difference<- merge(Fission, NoFission) %>%
      mutate(Difference = Fission1 - Fission0)
  
    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)
    
    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) + geom_density() + theme_minimal() + geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) + geom_segment(x = HDI_95$CI_low, y = 0, xend =  HDI_95$CI_high, yend = 0, colour = 'grey', size = 1) 
    
    SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")
    SummaryPlot
    
    #pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1, 
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")
  
   header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")  
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)
    
    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)
    
    
  cat("\n")
  #cat("\\newpage")
  cat("\n")    
  
  print(SummaryPlot)
  #dev.off() 
  p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")  
  }
```

### Model 3: *Number of Cells ~ Timing of Germline Segregation*


```{r GenusNoAnimalsModel3, results='asis', echo=FALSE}
Model = 3
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')    
    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```

### Model 4: *Number of Cell Types ~ Timing of Germline Segregation + log(Number of Cells)*


```{r GenusNoAnimalsModel4, results='asis', echo=FALSE}
Model = 4
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```


### Model 5: *Number of Cell Types ~ Timing of Germline Segregation *


```{r GenusNoAnimalsModel5, results='asis', echo=FALSE}
Model = '4WithoutCellNumber'
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')   
    
    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
   
    
  
     caption1 = paste("Estimates of Fixed Effects for  *Model ", "5", "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```

### Correlation between germline and fission 

This analysis was run to test for a phylogenetic association between early germline segregation and a strict bottleneck separating each generation. Prior set 4 above was used.

```{r GenusNoAnimalCorrelation, echo=F, results='asis'}
prior_set = 'p4'
Model = '_Correlation'

Model_Correlation_File<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')

Model_Correlation<- readRDS(Model_Correlation_File)

Model_Correlation_ROTL_Sol<- mcmc.list(lapply(Model_Correlation, function(m) m$Sol))
#plot(Model_Correlation_ROTL_Sol) 
#gelman.diag(Model_Correlation_ROTL_Sol,multivariate = FALSE)

Model_Correlation_ROTL_VCV<- mcmc.list(lapply(Model_Correlation, function(m) m$VCV))
#plot(Model_Correlation_ROTL_VCV) 
#gelman.diag(Model_Correlation_ROTL_VCV,multivariate = FALSE)
chain1<- Model_Correlation$chain1
#summary(Model_Correlation$chain1)


#phylogenetic heritability in each trait [intraclass correlation coefficient (ICC) for binary traits]
ICC_fission1<-chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
# posterior.mode(ICC_fission1)
# HPDinterval(ICC_fission1)
#plot(ICC_fission1)

ICC_germline1<-chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
#posterior.mode(ICC_germline1)
#HPDinterval(ICC_germline1)
#plot(ICC_germline1)


#calculate phylogenetic correlation
fission_germline1<-chain1$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])
#plot(fission_germline1)
#print(posterior.mode(fission_germline1))
#print(HPDinterval(fission_germline1))

#Can check the convergence of these terms
chain2<- Model_Correlation$chain2
chain3<- Model_Correlation$chain3
chain4<- Model_Correlation$chain4
chain5<- Model_Correlation$chain5
chain6<- Model_Correlation$chain6

ICC_fission2<-chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline2<-chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline2<-chain2$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission3<-chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline3<-chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline3<-chain3$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission4<-chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline4<-chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline4<-chain4$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission5<-chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline5<-chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline5<-chain5$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission6<-chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline6<-chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline6<-chain6$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission<-mcmc.list(ICC_fission1,ICC_fission2,ICC_fission3,ICC_fission4,ICC_fission5,ICC_fission6)
ICC_germline<-mcmc.list(ICC_germline1,ICC_germline2,ICC_germline3,ICC_germline4,ICC_germline5,ICC_germline6)
fission_germline<-mcmc.list(fission_germline1,fission_germline2,fission_germline3,fission_germline4,fission_germline5,fission_germline6)
varnames(fission_germline) <- 'correlation'


# plot(ICC_fission)
# gelman.diag(ICC_fission,multivariate = FALSE)
# 
# plot(ICC_germline)
# gelman.diag(ICC_germline,multivariate = FALSE)z
# 
# plot(fission_germline)
# gelman.diag(fission_germline,multivariate = FALSE)

```


Figure: A shows the convergence of all chains, B and C both show the posterior estimates and confidence intervals for the correlation between the *absence* of a strict bottleneck, and the *presence* of early germline segregation. 
This is shown only for 1 chain.

```{r GenusNoCorrelation2, echo=F, results='asis'}
#cat(summary(fission_germline))

trace<- mcmc_trace(fission_germline) + theme_minimal()
areas<- mcmc_areas(fission_germline) + theme_minimal()
intervals<- mcmc_intervals(fission_germline) + theme_minimal()

a<- ggarrange(trace, areas, intervals, ncol = 3, labels = 'AUTO')
a
```

For each chain, the posterior CI were as follows  
```{r}
HPDinterval(fission_germline)
```


### Ancestral state reconstruction
```{r GenusNoAnimalsAncestralState, echo = F, out.width="100%"}
knitr::include_graphics(paste("Results/", GenusVsSpecies,"Level/", WhichTaxa, "/Figures/AllPlotsPhylogeny.pdf", sep = ''))
```


# Analyses including only data from species

```{r, echo=F}
GenusVsSpecies = 'Species'
```

## Analyses with all data points
```{r, echo=F}
WhichTaxa='All'
```


### Model 1: *Number of Cells ~ Presence of Strict Bottleneck*


```{r SpeciesAllModel1, results='asis', echo=FALSE}
Model=1
p=1
  for(prior_set in c('p1','p2','p3')){
    
    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')
    
    ModelOutput <- readRDS(input_filename)
  
    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)  
    Sol_ggSubset<- subset(Sol_gg,  grepl('Fission', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species
    
    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()
    
    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)
    
    NoFission<- Sol_gg %>%
      filter(Parameter == 'Fission0') %>% 
      rename(Fission0 = value) %>% select(-Parameter)
    
    Fission<- Sol_gg %>%
      filter(Parameter == 'Fission1') %>%
      rename(Fission1 = value) %>% select(-Parameter)
    
    Difference<- merge(Fission, NoFission) %>%
      mutate(Difference = Fission1 - Fission0)
  
    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)
    
    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) + geom_density() + theme_minimal() + geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) + geom_segment(x = HDI_95$CI_low, y = 0, xend =  HDI_95$CI_high, yend = 0, colour = 'grey', size = 1) 
    
    SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")
    SummaryPlot
    
    #pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1, 
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")
  
   header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")  
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)
    
    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)
    
    
  cat("\n")
  #cat("\\newpage")
  cat("\n")    
  
  print(SummaryPlot)
  #dev.off() 
  p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")  
  }
```

### Model 2: *Number of Cell Types ~  Presence of Strict Bottleneck + log(Number of Cells)*


```{r SpeciesAllModel2, results='asis', echo=FALSE}
Model=2
p=1
  for(prior_set in c('p1','p2','p3')){
    
    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')
    
    ModelOutput <- readRDS(input_filename)
  
    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)  
    Sol_ggSubset<- subset(Sol_gg,  grepl('Fission', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species
    
    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()
    
    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)
    
    NoFission<- Sol_gg %>%
      filter(Parameter == 'Fission0') %>% 
      rename(Fission0 = value) %>% select(-Parameter)
    
    Fission<- Sol_gg %>%
      filter(Parameter == 'Fission1') %>%
      rename(Fission1 = value) %>% select(-Parameter)
    
    Difference<- merge(Fission, NoFission) %>%
      mutate(Difference = Fission1 - Fission0)
  
    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)
    
    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) + geom_density() + theme_minimal() + geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) + geom_segment(x = HDI_95$CI_low, y = 0, xend =  HDI_95$CI_high, yend = 0, colour = 'grey', size = 1) 
    
    SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")
    SummaryPlot
    
    #pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1, 
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")
  
   header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")  
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)
    
    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)
    
    
  cat("\n")
  #cat("\\newpage")
  cat("\n")    
  
  print(SummaryPlot)
  #dev.off() 
  p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")  
  }
```

### Model 3: *Number of Cells ~ Timing of Germline Segregation*


```{r SpeciesAllModel3, results='asis', echo=FALSE}
Model = 3
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')    
    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```

### Model 4: *Number of Cell Types ~ Timing of Germline Segregation + log(Number of Cells)*


```{r SpeciesAllModel4, results='asis', echo=FALSE}
Model = 4
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```


### Model 5: *Number of Cell Types ~ Timing of Germline Segregation *


```{r SpeciesAllModel5, results='asis', echo=FALSE}
Model = '4WithoutCellNumber'
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')   
    
    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
    caption1 = paste("Estimates of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)



  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```

### Correlation between germline and fission 

This analysis was run to test for a phylogenetic association between early germline segregation and a strict bottleneck separating each generation. Prior set 4 above was used.

```{r SpeciesAllCorrelation, echo=F, results='asis'}
prior_set = 'p4'
Model = '_Correlation'

Model_Correlation_File<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')

Model_Correlation<- readRDS(Model_Correlation_File)

Model_Correlation_ROTL_Sol<- mcmc.list(lapply(Model_Correlation, function(m) m$Sol))
#plot(Model_Correlation_ROTL_Sol) 
#gelman.diag(Model_Correlation_ROTL_Sol,multivariate = FALSE)

Model_Correlation_ROTL_VCV<- mcmc.list(lapply(Model_Correlation, function(m) m$VCV))
#plot(Model_Correlation_ROTL_VCV) 
#gelman.diag(Model_Correlation_ROTL_VCV,multivariate = FALSE)
chain1<- Model_Correlation$chain1
#summary(Model_Correlation$chain1)


#phylogenetic heritability in each trait [intraclass correlation coefficient (ICC) for binary traits]
ICC_fission1<-chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
# posterior.mode(ICC_fission1)
# HPDinterval(ICC_fission1)
#plot(ICC_fission1)

ICC_germline1<-chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
#posterior.mode(ICC_germline1)
#HPDinterval(ICC_germline1)
#plot(ICC_germline1)


#calculate phylogenetic correlation
fission_germline1<-chain1$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])
#plot(fission_germline1)
#print(posterior.mode(fission_germline1))
#print(HPDinterval(fission_germline1))

#Can check the convergence of these terms
chain2<- Model_Correlation$chain2
chain3<- Model_Correlation$chain3
chain4<- Model_Correlation$chain4
chain5<- Model_Correlation$chain5
chain6<- Model_Correlation$chain6

ICC_fission2<-chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline2<-chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline2<-chain2$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission3<-chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline3<-chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline3<-chain3$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission4<-chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline4<-chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline4<-chain4$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission5<-chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline5<-chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline5<-chain5$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission6<-chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline6<-chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline6<-chain6$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission<-mcmc.list(ICC_fission1,ICC_fission2,ICC_fission3,ICC_fission4,ICC_fission5,ICC_fission6)
ICC_germline<-mcmc.list(ICC_germline1,ICC_germline2,ICC_germline3,ICC_germline4,ICC_germline5,ICC_germline6)
fission_germline<-mcmc.list(fission_germline1,fission_germline2,fission_germline3,fission_germline4,fission_germline5,fission_germline6)
varnames(fission_germline) <- 'correlation'


# plot(ICC_fission)
# gelman.diag(ICC_fission,multivariate = FALSE)
# 
# plot(ICC_germline)
# gelman.diag(ICC_germline,multivariate = FALSE)z
# 
# plot(fission_germline)
# gelman.diag(fission_germline,multivariate = FALSE)

```


Figure: A shows the convergence of all chains, B and C both show the posterior estimates and confidence intervals for the correlation between the *absence* of a strict bottleneck, and the *presence* of early germline segregation. 
This is shown only for 1 chain.

```{r SpeciesAllCorrelation2, echo=F, results='asis'}
#cat(summary(fission_germline))

trace<- mcmc_trace(fission_germline) + theme_minimal()
areas<- mcmc_areas(fission_germline) + theme_minimal()
intervals<- mcmc_intervals(fission_germline) + theme_minimal()

a<- ggarrange(trace, areas, intervals, ncol = 3, labels = 'AUTO')
a
```

For each chain, the posterior CI were as follows  
```{r}
HPDinterval(fission_germline)
```


### Ancestral state reconstruction
```{r SpeciesAllAncestralState, echo = F, out.width="100%"}
knitr::include_graphics(paste("Results/", GenusVsSpecies,"Level/", WhichTaxa, "/Figures/AllPlotsPhylogeny.pdf", sep = ''))
```




```{r, echo=F}
GenusVsSpecies = 'Genus'
```

## Analyses with data points from only the animals
```{r, echo=F}
WhichTaxa='OnlyAnimals'
```


### Model 1: *Number of Cells ~ Presence of Strict Bottleneck*


```{r SpeciesAnimalsModel1, results='asis', echo=FALSE}
Model=1
p=1
  for(prior_set in c('p1','p2','p3')){
    
    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')
    
    ModelOutput <- readRDS(input_filename)
  
    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)  
    Sol_ggSubset<- subset(Sol_gg,  grepl('Fission', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species
    
    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()
    
    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)
    
    NoFission<- Sol_gg %>%
      filter(Parameter == 'Fission0') %>% 
      rename(Fission0 = value) %>% select(-Parameter)
    
    Fission<- Sol_gg %>%
      filter(Parameter == 'Fission1') %>%
      rename(Fission1 = value) %>% select(-Parameter)
    
    Difference<- merge(Fission, NoFission) %>%
      mutate(Difference = Fission1 - Fission0)
  
    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)
    
    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) + geom_density() + theme_minimal() + geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) + geom_segment(x = HDI_95$CI_low, y = 0, xend =  HDI_95$CI_high, yend = 0, colour = 'grey', size = 1) 
    
    SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")
    SummaryPlot
    
    #pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1, 
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")
  
   header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")  
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)
    
    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)
    
    
  cat("\n")
  #cat("\\newpage")
  cat("\n")    
  
  print(SummaryPlot)
  #dev.off() 
  p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")  
  }
```

### Model 2: *Number of Cell Types ~  Presence of Strict Bottleneck + log(Number of Cells)*


```{r SpeciesAnimalsModel2, results='asis', echo=FALSE}
Model=2
p=1
  for(prior_set in c('p1','p2','p3')){
    
    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')
    
    ModelOutput <- readRDS(input_filename)
  
    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)  
    Sol_ggSubset<- subset(Sol_gg,  grepl('Fission', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species
    
    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()
    
    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)
    
    NoFission<- Sol_gg %>%
      filter(Parameter == 'Fission0') %>% 
      rename(Fission0 = value) %>% select(-Parameter)
    
    Fission<- Sol_gg %>%
      filter(Parameter == 'Fission1') %>%
      rename(Fission1 = value) %>% select(-Parameter)
    
    Difference<- merge(Fission, NoFission) %>%
      mutate(Difference = Fission1 - Fission0)
  
    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)
    
    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) + geom_density() + theme_minimal() + geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) + geom_segment(x = HDI_95$CI_low, y = 0, xend =  HDI_95$CI_high, yend = 0, colour = 'grey', size = 1) 
    
    SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")
    SummaryPlot
    
    #pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1, 
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")
  
   header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")  
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)
    
    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)
    
    
  cat("\n")
  #cat("\\newpage")
  cat("\n")    
  
  print(SummaryPlot)
  #dev.off() 
  p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")  
  }
```

### Model 3: *Number of Cells ~ Timing of Germline Segregation*

```{r SpeciesAnimalsModel3, results='asis', echo=FALSE}
Model = 3
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')    
    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```

### Model 4: *Number of Cell Types ~ Timing of Germline Segregation + log(Number of Cells)*


```{r SpeciesAnimalsModel4, results='asis', echo=FALSE}
Model = 4
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```


### Model 5: *Number of Cell Types ~ Timing of Germline Segregation *


```{r SpeciesAnimalsModel5, results='asis', echo=FALSE}
Model = '4WithoutCellNumber'
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')   
    
    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
    caption1 = paste("Estimates of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```

### Correlation between germline and fission 

This analysis was run to test for a phylogenetic association between early germline segregation and a strict bottleneck separating each generation. Prior set 4 above was used.

```{r SpeciesAnimalCorrelation, echo=F, results='asis'}
prior_set = 'p4'
Model = '_Correlation'

Model_Correlation_File<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')

Model_Correlation<- readRDS(Model_Correlation_File)

Model_Correlation_ROTL_Sol<- mcmc.list(lapply(Model_Correlation, function(m) m$Sol))
#plot(Model_Correlation_ROTL_Sol) 
#gelman.diag(Model_Correlation_ROTL_Sol,multivariate = FALSE)

Model_Correlation_ROTL_VCV<- mcmc.list(lapply(Model_Correlation, function(m) m$VCV))
#plot(Model_Correlation_ROTL_VCV) 
#gelman.diag(Model_Correlation_ROTL_VCV,multivariate = FALSE)
chain1<- Model_Correlation$chain1
#summary(Model_Correlation$chain1)


#phylogenetic heritability in each trait [intraclass correlation coefficient (ICC) for binary traits]
ICC_fission1<-chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
# posterior.mode(ICC_fission1)
# HPDinterval(ICC_fission1)
#plot(ICC_fission1)

ICC_germline1<-chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
#posterior.mode(ICC_germline1)
#HPDinterval(ICC_germline1)
#plot(ICC_germline1)


#calculate phylogenetic correlation
fission_germline1<-chain1$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])
#plot(fission_germline1)
#print(posterior.mode(fission_germline1))
#print(HPDinterval(fission_germline1))

#Can check the convergence of these terms
chain2<- Model_Correlation$chain2
chain3<- Model_Correlation$chain3
chain4<- Model_Correlation$chain4
chain5<- Model_Correlation$chain5
chain6<- Model_Correlation$chain6

ICC_fission2<-chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline2<-chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline2<-chain2$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission3<-chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline3<-chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline3<-chain3$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission4<-chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline4<-chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline4<-chain4$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission5<-chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline5<-chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline5<-chain5$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission6<-chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline6<-chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline6<-chain6$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission<-mcmc.list(ICC_fission1,ICC_fission2,ICC_fission3,ICC_fission4,ICC_fission5,ICC_fission6)
ICC_germline<-mcmc.list(ICC_germline1,ICC_germline2,ICC_germline3,ICC_germline4,ICC_germline5,ICC_germline6)
fission_germline<-mcmc.list(fission_germline1,fission_germline2,fission_germline3,fission_germline4,fission_germline5,fission_germline6)
varnames(fission_germline) <- 'correlation'


# plot(ICC_fission)
# gelman.diag(ICC_fission,multivariate = FALSE)
# 
# plot(ICC_germline)
# gelman.diag(ICC_germline,multivariate = FALSE)z
# 
# plot(fission_germline)
# gelman.diag(fission_germline,multivariate = FALSE)

```


Figure: A shows the convergence of all chains, B and C both show the posterior estimates and confidence intervals for the correlation between the *absence* of a strict bottleneck, and the *presence* of early germline segregation. 
This is shown only for 1 chain.

```{r SpeciesAnimalsCorrelation2, echo=F, results='asis'}
#cat(summary(fission_germline))

trace<- mcmc_trace(fission_germline) + theme_minimal()
areas<- mcmc_areas(fission_germline) + theme_minimal()
intervals<- mcmc_intervals(fission_germline) + theme_minimal()

a<- ggarrange(trace, areas, intervals, ncol = 3, labels = 'AUTO')
a
```

For each chain, the posterior CI were as follows  
```{r}
HPDinterval(fission_germline)
```


### Ancestral state reconstruction
```{r SpeciesAnimalsAncestralState, echo = F, out.width="100%"}
knitr::include_graphics(paste("Results/", GenusVsSpecies,"Level/", WhichTaxa, "/Figures/AllPlotsPhylogeny.pdf", sep = ''))
```

## Analyses with data points excluding the animals
```{r, echo=F}
WhichTaxa='NoAnimals'
```


### Model 1: *Number of Cells ~ Presence of Strict Bottleneck*


```{r SpeciesNoAnimalsModel1, results='asis', echo=FALSE}
Model=1
p=1
  for(prior_set in c('p1','p2','p3')){
    
    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')
    
    ModelOutput <- readRDS(input_filename)
  
    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)  
    Sol_ggSubset<- subset(Sol_gg,  grepl('Fission', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species
    
    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()
    
    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)
    
    NoFission<- Sol_gg %>%
      filter(Parameter == 'Fission0') %>% 
      rename(Fission0 = value) %>% select(-Parameter)
    
    Fission<- Sol_gg %>%
      filter(Parameter == 'Fission1') %>%
      rename(Fission1 = value) %>% select(-Parameter)
    
    Difference<- merge(Fission, NoFission) %>%
      mutate(Difference = Fission1 - Fission0)
  
    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)
    
    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) + geom_density() + theme_minimal() + geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) + geom_segment(x = HDI_95$CI_low, y = 0, xend =  HDI_95$CI_high, yend = 0, colour = 'grey', size = 1) 
    
    SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")
    SummaryPlot
    
    #pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1, 
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")
  
   header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")  
    cat(header)
    caption1 = paste("Estimates of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)

    
  cat("\n")
  #cat("\\newpage")
  cat("\n")    
  
  print(SummaryPlot)
  #dev.off() 
  p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")  
  }
```

### Model 2: *Number of Cell Types ~  Presence of Strict Bottleneck + log(Number of Cells)*


```{r SpeciesNoAnimalsModel2, results='asis', echo=FALSE}
Model=2
p=1
  for(prior_set in c('p1','p2','p3')){
    
    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')
    
    ModelOutput <- readRDS(input_filename)
  
    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)  
    Sol_ggSubset<- subset(Sol_gg,  grepl('Fission', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species
    
    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()
    
    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)
    
    NoFission<- Sol_gg %>%
      filter(Parameter == 'Fission0') %>% 
      rename(Fission0 = value) %>% select(-Parameter)
    
    Fission<- Sol_gg %>%
      filter(Parameter == 'Fission1') %>%
      rename(Fission1 = value) %>% select(-Parameter)
    
    Difference<- merge(Fission, NoFission) %>%
      mutate(Difference = Fission1 - Fission0)
  
    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)
    
    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) + geom_density() + theme_minimal() + geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) + geom_segment(x = HDI_95$CI_low, y = 0, xend =  HDI_95$CI_high, yend = 0, colour = 'grey', size = 1) 
    
    SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")
    SummaryPlot
    
    #pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1, 
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")
  
   header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")  
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)
    
    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)
    
    
  cat("\n")
  #cat("\\newpage")
  cat("\n")    
  
  print(SummaryPlot)
  #dev.off() 
  p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")  
  }
```

### Model 3: *Number of Cells ~ Timing of Germline Segregation*


```{r SpeciesNoAnimalsModel3, results='asis', echo=FALSE}
Model = 3
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')    
    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```

### Model 4: *Number of Cell Types ~ Timing of Germline Segregation + log(Number of Cells)*


```{r SpeciesNoAnimalsModel4, results='asis', echo=FALSE}
Model = 4
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
caption1 = paste("Estimates of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for *Model ", Model, "* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```


### Model 5: *Number of Cell Types ~ Timing of Germline Segregation *


```{r SpeciesNoAnimalsModel5, results='asis', echo=FALSE}
Model = '4WithoutCellNumber'
  p=1
  for(prior_set in c('p1','p2','p3')){

    #read in model
    input_filename<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')   
    
    
    ModelOutput <- readRDS(input_filename)

    Sol_mcmc<- mcmc.list(lapply(ModelOutput, function(m) m$Sol))
    Sol_gg<- ggmcmc::ggs(Sol_mcmc)
    Sol_ggSubset<- subset(Sol_gg,  grepl('Germ', Sol_gg$Parameter)) #need to subset so we don't get a plot for each species

    Sol_traceplot <- ggmcmc::ggs_traceplot(Sol_ggSubset) + theme_minimal()
    Sol_caterpillar<- ggmcmc::ggs_caterpillar(Sol_ggSubset) + theme_minimal()

    SolGelman<- gelman.diag(Sol_mcmc,multivariate = FALSE)

    GermlineAdult<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpadult') %>%
      rename(Adult = value) %>% select(-Parameter)

    GermlineEarly<- Sol_gg %>%
      filter(Parameter == 'GermTimeSimpearly') %>%
      rename(Early = value) %>% select(-Parameter)

    Difference<- merge(GermlineEarly, GermlineAdult) %>%
      mutate(Difference = Early - Adult)

    HDI_90<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.90)
    HDI_95<- bayestestR::ci(Difference$Difference, method = 'HDI', ci = 0.95)

    DifPlotM<- ggplot(Difference, aes(colour = as.factor(Chain), x = Difference)) +
      geom_density() + theme_minimal() +
      geom_segment(x = HDI_90$CI_low, y = 0, xend = HDI_90$CI_high, yend = 0, colour = 'grey', size = 4) +
      geom_segment(x = HDI_95$CI_low, y = 0, xend = HDI_95$CI_high, yend = 0, colour = 'grey', size = 1)

        SummaryPlot<- ggarrange(Sol_traceplot, Sol_caterpillar, DifPlotM, labels = "AUTO")


#pMCMC
    fixed_names_list<- colnames(ModelOutput$chain1$Sol)
    FixedEffectsTables<- GenerateFixedEffectsTable(model = ModelOutput$chain1,
                              link="poisson",
                              fixed_names=fixed_names_list,
                              fixed_diffinc = c("all"),
                              pvalues = "include")

    header= paste(
      "Model ", Model,", prior set ", prior_set, sep = ''
    )
    cat("\n")
    cat("\\newpage")
    cat("\n")
    cat(header)
    caption1 = paste("Estimates of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table1<- knitr::kable(FixedEffectsTables[1], caption = caption1, "latex")
    print(table1)

    caption2 = paste("Comparisons of Fixed Effects for Model *5* with prior set *", prior_set, "* for *" , WhichTaxa, "* taxa, at the *", GenusVsSpecies, "* level",  sep = '' )
    table2<- knitr::kable(FixedEffectsTables[2], caption = caption2, "latex")
    print(table2)


  cat("\n")
  #cat("\\newpage")
  cat("\n")

    print(SummaryPlot)
    #dev.off()
    p = p + 1
  # insert page break
   cat("\n")
   cat("\\newpage")
   cat("\n")
  }


```

### Correlation between germline and fission 

This analysis was run to test for a phylogenetic association between early germline segregation and a strict bottleneck separating each generation. Prior set 4 above was used.

```{r SpeciesNoAnimalCorrelation, echo=F, results='asis'}
prior_set = 'p4'
Model = '_Correlation'

Model_Correlation_File<- paste("Results/",GenusVsSpecies, 'Level/', WhichTaxa, "/R_Objects/ModelOutputs/", prior_set,
                           "/Model",Model,"_ROTL_", prior_set, ".RDS", sep = '')

Model_Correlation<- readRDS(Model_Correlation_File)

Model_Correlation_ROTL_Sol<- mcmc.list(lapply(Model_Correlation, function(m) m$Sol))
#plot(Model_Correlation_ROTL_Sol) 
#gelman.diag(Model_Correlation_ROTL_Sol,multivariate = FALSE)

Model_Correlation_ROTL_VCV<- mcmc.list(lapply(Model_Correlation, function(m) m$VCV))
#plot(Model_Correlation_ROTL_VCV) 
#gelman.diag(Model_Correlation_ROTL_VCV,multivariate = FALSE)
chain1<- Model_Correlation$chain1
#summary(Model_Correlation$chain1)


#phylogenetic heritability in each trait [intraclass correlation coefficient (ICC) for binary traits]
ICC_fission1<-chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
# posterior.mode(ICC_fission1)
# HPDinterval(ICC_fission1)
#plot(ICC_fission1)

ICC_germline1<-chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
#posterior.mode(ICC_germline1)
#HPDinterval(ICC_germline1)
#plot(ICC_germline1)


#calculate phylogenetic correlation
fission_germline1<-chain1$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain1$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain1$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])
#plot(fission_germline1)
#print(posterior.mode(fission_germline1))
#print(HPDinterval(fission_germline1))

#Can check the convergence of these terms
chain2<- Model_Correlation$chain2
chain3<- Model_Correlation$chain3
chain4<- Model_Correlation$chain4
chain5<- Model_Correlation$chain5
chain6<- Model_Correlation$chain6

ICC_fission2<-chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline2<-chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline2<-chain2$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain2$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain2$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission3<-chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline3<-chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline3<-chain3$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain3$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain3$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission4<-chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline4<-chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline4<-chain4$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain4$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain4$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission5<-chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline5<-chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline5<-chain5$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain5$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain5$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission6<-chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']/((chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']+chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.units'])+pi^2/3)
ICC_germline6<-chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']/((chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl']+chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.units'])+pi^2/3)
fission_germline6<-chain6$VCV[,'traitEarlyGermlineBinary.2:traitFissionBinary.2.species_rotl']/sqrt(chain6$VCV[,'traitFissionBinary.2:traitFissionBinary.2.species_rotl']*chain6$VCV[,'traitEarlyGermlineBinary.2:traitEarlyGermlineBinary.2.species_rotl'])

ICC_fission<-mcmc.list(ICC_fission1,ICC_fission2,ICC_fission3,ICC_fission4,ICC_fission5,ICC_fission6)
ICC_germline<-mcmc.list(ICC_germline1,ICC_germline2,ICC_germline3,ICC_germline4,ICC_germline5,ICC_germline6)
fission_germline<-mcmc.list(fission_germline1,fission_germline2,fission_germline3,fission_germline4,fission_germline5,fission_germline6)
varnames(fission_germline) <- 'correlation'


# plot(ICC_fission)
# gelman.diag(ICC_fission,multivariate = FALSE)
# 
# plot(ICC_germline)
# gelman.diag(ICC_germline,multivariate = FALSE)z
# 
# plot(fission_germline)
# gelman.diag(fission_germline,multivariate = FALSE)

```


Figure: A shows the convergence of all chains, B and C both show the posterior estimates and confidence intervals for the correlation between the *absence* of a strict bottleneck, and the *presence* of early germline segregation. 
This is shown only for 1 chain.

```{r SpeciesNoCorrelation2, echo=F, results='asis'}
#cat(summary(fission_germline))

trace<- mcmc_trace(fission_germline) + theme_minimal()
areas<- mcmc_areas(fission_germline) + theme_minimal()
intervals<- mcmc_intervals(fission_germline) + theme_minimal()

a<- ggarrange(trace, areas, intervals, ncol = 3, labels = 'AUTO')
a
```

For each chain, the posterior CI were as follows  
```{r}
HPDinterval(fission_germline)
```

### Ancestral state reconstruction
```{r SpeciesNoAnimalsAncestralState, echo = F, out.width="100%"}
knitr::include_graphics(paste("Results/", GenusVsSpecies,"Level/", WhichTaxa, "/Figures/AllPlotsPhylogeny.pdf", sep = ''))
```
